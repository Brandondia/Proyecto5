<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Barbero - Barbería</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        .section-header {
            background: #f8f9fa;
            padding: 10px 15px;
            margin: 20px -15px 15px -15px;
            border-left: 4px solid #0d6efd;
        }
        .required-field::after {
            content: " *";
            color: red;
        }
        .password-toggle {
            cursor: pointer;
            position: absolute;
            right: 10px;
            top: 38px;
            z-index: 10;
        }
        .password-wrapper {
            position: relative;
        }
        .password-match {
            border-color: #198754 !important;
        }
        .password-mismatch {
            border-color: #dc3545 !important;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/admin/panel">Panel de Administración</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/panel">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/admin/barberos">Barberos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/cortes">Servicios</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/turnos">Turnos</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container py-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 th:text="${barbero.idBarbero == null ? 'Nuevo Barbero' : 'Editar Barbero'}">Formulario de Barbero</h1>
            <a href="/admin/barberos" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Volver a la lista
            </a>
        </div>

        <!-- Alertas -->
        <div th:if="${mensaje}" class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-check-circle-fill"></i> <span th:utext="${mensaje}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="bi bi-exclamation-triangle-fill"></i> <span th:text="${error}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        
        <div class="card">
            <div class="card-body">
                <form th:action="@{/admin/barberos/guardar}" th:object="${barbero}" method="post" id="formBarbero">
                    <input type="hidden" th:field="*{idBarbero}" />
                    
                    <!-- ==================== INFORMACIÓN BÁSICA ==================== -->
                    <div class="section-header">
                        <h5 class="mb-0"><i class="bi bi-person-badge"></i> Información Básica</h5>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="nombre" class="form-label required-field">Nombre</label>
                            <input type="text" class="form-control" id="nombre" th:field="*{nombre}" 
                                   placeholder="Ej: Juan" required>
                            <div class="form-text">Nombre del barbero (requerido)</div>
                        </div>
                        <div class="col-md-6">
                            <label for="apellido" class="form-label required-field">Apellido</label>
                            <input type="text" class="form-control" id="apellido" th:field="*{apellido}" 
                                   placeholder="Ej: Pérez" required>
                            <div class="form-text">Apellido del barbero (requerido)</div>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="email" class="form-label required-field">Email (Usuario)</label>
                            <input type="email" class="form-control" id="email" th:field="*{email}" 
                                   placeholder="ejemplo@email.com" required
                                   th:readonly="${barbero.idBarbero != null}">
                            <div class="form-text">
                                <i class="bi bi-info-circle"></i> Este email se usará como nombre de usuario para iniciar sesión
                                <span th:if="${barbero.idBarbero != null}" class="text-warning">
                                    <br><i class="bi bi-lock"></i> No se puede cambiar el email de un barbero existente
                                </span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="telefono" class="form-label">Teléfono</label>
                            <input type="tel" class="form-control" id="telefono" th:field="*{telefono}" 
                                   placeholder="+57 300 123 4567">
                        </div>
                    </div>

                    <!-- ==================== CONTRASEÑAS CON VALIDACIÓN ==================== -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="password" class="form-label" th:classappend="${barbero.idBarbero == null ? 'required-field' : ''}">
                                Contraseña
                            </label>
                            <div class="password-wrapper">
                                <input type="password" class="form-control" id="password" 
                                       th:field="*{password}" 
                                       placeholder="Mínimo 6 caracteres"
                                       th:required="${barbero.idBarbero == null}"
                                       minlength="6">
                                <i class="bi bi-eye-slash password-toggle" id="togglePassword"></i>
                            </div>
                            <div class="form-text">
                                <span th:if="${barbero.idBarbero == null}">
                                    <i class="bi bi-key"></i> Requerido para nuevos barberos (mínimo 6 caracteres)
                                </span>
                                <span th:if="${barbero.idBarbero != null}">
                                    <i class="bi bi-info-circle"></i> Dejar en blanco para mantener la contraseña actual
                                </span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="confirmarPassword" class="form-label" th:classappend="${barbero.idBarbero == null ? 'required-field' : ''}">
                                Confirmar Contraseña
                            </label>
                            <div class="password-wrapper">
                                <input type="password" class="form-control" id="confirmarPassword" 
                                       name="confirmarPassword"
                                       placeholder="Repetir contraseña"
                                       th:required="${barbero.idBarbero == null}"
                                       minlength="6">
                                <i class="bi bi-eye-slash password-toggle" id="toggleConfirmPassword"></i>
                            </div>
                            <div id="passwordMatch" class="form-text"></div>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="documento" class="form-label">Documento de Identidad</label>
                            <input type="text" class="form-control" id="documento" th:field="*{documento}" 
                                   placeholder="Cédula o DNI">
                            <small class="text-muted">Debe ser único (si se proporciona)</small>
                        </div>
                    </div>

                    <!-- ==================== INFORMACIÓN PROFESIONAL ==================== -->
                    <div class="section-header">
                        <h5 class="mb-0"><i class="bi bi-scissors"></i> Información Profesional</h5>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="especialidad" class="form-label required-field">Especialidad</label>
                            <input type="text" class="form-control" id="especialidad" th:field="*{especialidad}" 
                                   placeholder="Ej: Corte clásico, Barba, Afeitado" required>
                            <div class="form-text">Principal especialidad o tipo de cortes</div>
                        </div>
                        <div class="col-md-6">
                            <label for="experienciaAnios" class="form-label">Años de Experiencia</label>
                            <input type="number" class="form-control" id="experienciaAnios" 
                                   th:field="*{experienciaAnios}" min="0" placeholder="5">
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="certificaciones" class="form-label">Certificaciones</label>
                        <textarea class="form-control" id="certificaciones" th:field="*{certificaciones}" 
                                  rows="2" placeholder="Ej: Certificado en barbería profesional, Curso de estilismo..."></textarea>
                        <div class="form-text">Certificaciones o cursos relevantes (opcional)</div>
                    </div>
                    
                    <!-- ==================== CONFIGURACIÓN DE HORARIO ==================== -->
                    <div class="section-header">
                        <h5 class="mb-0"><i class="bi bi-clock"></i> Configuración de Horario</h5>
                    </div>
                    
                    <div class="mb-3">
                        <label for="diaLibre" class="form-label required-field">Día Libre</label>
                        <select class="form-select" id="diaLibre" th:field="*{diaLibre}" required>
                            <option value="">-- Seleccione un día --</option>
                            <option th:each="dia : ${diasSemana}" 
                                    th:value="${dia}" 
                                    th:text="${#strings.capitalize(#strings.toLowerCase(dia))}">MONDAY</option>
                        </select>
                        <div class="form-text">Día de la semana en que el barbero no trabaja</div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="horaInicio" class="form-label required-field">Hora de Inicio</label>
                            <input type="time" class="form-control" id="horaInicio" th:field="*{horaInicio}" 
                                   value="08:00" required>
                            <div class="form-text">Hora de inicio de la jornada laboral</div>
                        </div>
                        <div class="col-md-6">
                            <label for="horaFin" class="form-label required-field">Hora de Fin</label>
                            <input type="time" class="form-control" id="horaFin" th:field="*{horaFin}" 
                                   value="18:00" required>
                            <div class="form-text">Hora de fin de la jornada laboral</div>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="horaInicioAlmuerzo" class="form-label required-field">Inicio de Almuerzo</label>
                            <input type="time" class="form-control" id="horaInicioAlmuerzo" 
                                   th:field="*{horaInicioAlmuerzo}" value="12:00" required>
                        </div>
                        <div class="col-md-6">
                            <label for="horaFinAlmuerzo" class="form-label required-field">Fin de Almuerzo</label>
                            <input type="time" class="form-control" id="horaFinAlmuerzo" 
                                   th:field="*{horaFinAlmuerzo}" value="13:00" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="duracionTurno" class="form-label required-field">Duración de Turno (minutos)</label>
                        <input type="number" class="form-control" id="duracionTurno" th:field="*{duracionTurno}" 
                               min="15" step="5" value="30" required>
                        <div class="form-text">Duración de cada turno en minutos (Ej: 30, 45, 60)</div>
                    </div>

                    <!-- ==================== ESTADO Y NOTIFICACIONES ==================== -->
                    <div class="section-header">
                        <h5 class="mb-0"><i class="bi bi-gear"></i> Configuración del Sistema</h5>
                    </div>

                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="activo" th:field="*{activo}" checked>
                            <label class="form-check-label" for="activo">
                                <strong>Barbero Activo</strong>
                                <br><small class="text-muted">Si está inactivo, no podrá iniciar sesión ni recibir reservas</small>
                            </label>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label"><i class="bi bi-bell"></i> Notificaciones</label>
                        
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="notifReservas" 
                                   th:field="*{notifReservas}" checked>
                            <label class="form-check-label" for="notifReservas">
                                Notificar nuevas reservas
                            </label>
                        </div>
                        
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="notifCancelaciones" 
                                   th:field="*{notifCancelaciones}" checked>
                            <label class="form-check-label" for="notifCancelaciones">
                                Notificar cancelaciones
                            </label>
                        </div>
                        
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="notifRecordatorios" 
                                   th:field="*{notifRecordatorios}" checked>
                            <label class="form-check-label" for="notifRecordatorios">
                                Enviar recordatorios
                            </label>
                        </div>
                    </div>

                    <!-- ==================== INFORMACIÓN ADICIONAL ==================== -->
                    <div class="section-header">
                        <h5 class="mb-0"><i class="bi bi-info-circle"></i> Información Adicional (Opcional)</h5>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="fechaNacimiento" class="form-label">Fecha de Nacimiento</label>
                            <input type="date" class="form-control" id="fechaNacimiento" 
                                   th:field="*{fechaNacimiento}">
                        </div>
                        <div class="col-md-6">
                            <label for="direccion" class="form-label">Dirección</label>
                            <input type="text" class="form-control" id="direccion" th:field="*{direccion}" 
                                   placeholder="Calle 123 #45-67">
                        </div>
                    </div>
                    
                    <!-- Botones de Acción -->
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                        <a href="/admin/barberos" class="btn btn-secondary">
                            <i class="bi bi-x-circle"></i> Cancelar
                        </a>
                        <button type="submit" class="btn btn-primary" id="btnGuardar">
                            <i class="bi bi-save"></i> 
                            <span th:text="${barbero.idBarbero == null ? 'Crear Barbero' : 'Actualizar Barbero'}">Guardar</span>
                        </button>
                    </div>

                    <!-- Información importante -->
                    <div class="alert alert-info mt-4" th:if="${barbero.idBarbero == null}">
                        <h6 class="alert-heading"><i class="bi bi-info-circle-fill"></i> Información Importante</h6>
                        <ul class="mb-0">
                            <li>Al crear el barbero, se generará automáticamente una cuenta de acceso</li>
                            <li>El barbero podrá iniciar sesión con el <strong>email</strong> y <strong>contraseña</strong> proporcionados</li>
                            <li>Tendrá acceso al panel de barbero en <code>/barbero/panel</code></li>
                            <li>Los campos marcados con <span class="text-danger">*</span> son obligatorios</li>
                            <li><strong>Las contraseñas deben coincidir</strong> para poder crear la cuenta</li>
                        </ul>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>Barbería Estilo - Panel de Administración</h5>
                    <p>Sistema de gestión para administradores.</p>
                </div>
            </div>
            <div class="text-center mt-4">
                <p>&copy; 2025 Barbería Estilo. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Script para toggle de contraseñas y validación -->
    <script>
        // Toggle para ver/ocultar contraseña principal
        const togglePassword = document.querySelector('#togglePassword');
        const password = document.querySelector('#password');
        
        togglePassword.addEventListener('click', function () {
            const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
            password.setAttribute('type', type);
            this.classList.toggle('bi-eye');
            this.classList.toggle('bi-eye-slash');
        });
        
        // Toggle para ver/ocultar confirmación de contraseña
        const toggleConfirmPassword = document.querySelector('#toggleConfirmPassword');
        const confirmPassword = document.querySelector('#confirmarPassword');
        
        toggleConfirmPassword.addEventListener('click', function () {
            const type = confirmPassword.getAttribute('type') === 'password' ? 'text' : 'password';
            confirmPassword.setAttribute('type', type);
            this.classList.toggle('bi-eye');
            this.classList.toggle('bi-eye-slash');
        });
        
        // Validar que las contraseñas coincidan en tiempo real
        const passwordMatch = document.querySelector('#passwordMatch');
        const btnGuardar = document.querySelector('#btnGuardar');
        
        function validarContraseñas() {
            const pass = password.value;
            const confirmPass = confirmPassword.value;
            
            // Si ambos campos están vacíos (edición sin cambiar contraseña)
            if (pass === '' && confirmPass === '') {
                confirmPassword.classList.remove('password-match', 'password-mismatch');
                passwordMatch.innerHTML = '';
                btnGuardar.disabled = false;
                return;
            }
            
            // Si alguno tiene valor, validar
            if (pass !== '' || confirmPass !== '') {
                if (pass === confirmPass && pass.length >= 6) {
                    confirmPassword.classList.remove('password-mismatch');
                    confirmPassword.classList.add('password-match');
                    passwordMatch.innerHTML = '<i class="bi bi-check-circle-fill text-success"></i> Las contraseñas coinciden';
                    passwordMatch.className = 'form-text text-success';
                    btnGuardar.disabled = false;
                } else if (pass === confirmPass && pass.length < 6) {
                    confirmPassword.classList.remove('password-match');
                    confirmPassword.classList.add('password-mismatch');
                    passwordMatch.innerHTML = '<i class="bi bi-exclamation-triangle-fill text-warning"></i> La contraseña debe tener al menos 6 caracteres';
                    passwordMatch.className = 'form-text text-warning';
                    btnGuardar.disabled = true;
                } else {
                    confirmPassword.classList.remove('password-match');
                    confirmPassword.classList.add('password-mismatch');
                    passwordMatch.innerHTML = '<i class="bi bi-x-circle-fill text-danger"></i> Las contraseñas no coinciden';
                    passwordMatch.className = 'form-text text-danger';
                    btnGuardar.disabled = true;
                }
            }
        }
        
        password.addEventListener('input', validarContraseñas);
        confirmPassword.addEventListener('input', validarContraseñas);
        
        // Validación al cargar la página
        document.addEventListener('DOMContentLoaded', function() {
            validarContraseñas();
        });
    </script>
</body>
</html>