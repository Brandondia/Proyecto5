<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Reservas - Panel del Barbero</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        /* Estilos para los botones de filtro activos */
        .btn-group .btn.active {
            background-color: #0d6efd;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/barbero/panel">Panel del Barbero</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/barbero/panel">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/barbero/reservas">Mis Reservas</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/barbero/horario">Mi Horario</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/barbero/ausencias">Ausencias</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-person-circle"></i> <span th:text="${nombreBarbero ?: 'Barbero'}">Barbero</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="/barbero/perfil"><i class="bi bi-person"></i> Mi Perfil</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/logout"><i class="bi bi-box-arrow-right"></i> Cerrar Sesión</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container py-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Gestión de Reservas</h1>
        </div>

        <!-- Mensajes de alerta -->
        <div th:if="${mensaje}" class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${mensaje}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="bi bi-exclamation-triangle-fill"></i> <span th:text="${error}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>

        <!-- Filtros con Botones -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="mb-0"><i class="bi bi-filter"></i> Filtrar por período:</h5>
                </div>
                <div class="btn-group w-100" role="group">
                    <a href="/barbero/reservas?filtro=hoy" 
                       th:classappend="${filtroActual == 'hoy' ? 'active' : ''}"
                       class="btn btn-outline-primary">
                        <i class="bi bi-calendar-day"></i> Hoy
                    </a>
                    <a href="/barbero/reservas?filtro=semana" 
                       th:classappend="${filtroActual == 'semana' ? 'active' : ''}"
                       class="btn btn-outline-primary">
                        <i class="bi bi-calendar-week"></i> Esta Semana
                    </a>
                    <a href="/barbero/reservas?filtro=mes" 
                       th:classappend="${filtroActual == 'mes' ? 'active' : ''}"
                       class="btn btn-outline-primary">
                        <i class="bi bi-calendar-month"></i> Este Mes
                    </a>
                    <a href="/barbero/reservas?filtro=todas" 
                       th:classappend="${filtroActual == 'todas' ? 'active' : ''}"
                       class="btn btn-outline-primary">
                        <i class="bi bi-calendar3"></i> Todas
                    </a>
                </div>
            </div>
        </div>

        <!-- Tabla de reservas -->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Fecha Reserva</th>
                                <th>Fecha Turno</th>
                                <th>Cliente</th>
                                <th>Servicio</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="reserva : ${reservasHoyList}">
                                <td th:text="${reserva.idReserva}">1</td>
                                <td th:text="${reserva.fechaHoraReserva != null ? #temporals.format(reserva.fechaHoraReserva, 'dd/MM/yyyy HH:mm') : 'N/A'}">01/01/2025 10:00</td>
                                <td th:text="${reserva.fechaHoraTurno != null ? #temporals.format(reserva.fechaHoraTurno, 'dd/MM/yyyy HH:mm') : 'N/A'}">05/01/2025 15:30</td>
                                <td th:text="${reserva.cliente != null ? reserva.cliente.nombre : 'N/A'}">Cliente</td>
                                <td th:text="${reserva.corte != null ? reserva.corte.nombre : 'N/A'}">Servicio</td>
                                <td>
                                    <span th:class="${'badge ' + 
                                        (reserva.estado.name() == 'PENDIENTE' ? 'bg-warning' : 
                                        (reserva.estado.name() == 'COMPLETADA' ? 'bg-success' : 'bg-danger'))}">
                                        <span th:text="${reserva.estado}">Estado</span>
                                    </span>
                                </td>
                                <td>
                                    <div class="btn-group" role="group">
                                        <button class="btn btn-info btn-sm"
                                                th:data-id="${reserva.idReserva}"
                                                th:data-cliente-nombre="${reserva.cliente != null ? reserva.cliente.nombre : 'N/A'}"
                                                th:data-cliente-telefono="${reserva.cliente != null ? reserva.cliente.telefono : 'N/A'}"
                                                th:data-cliente-correo="${reserva.cliente != null ? reserva.cliente.correo : 'N/A'}"
                                                th:data-servicio="${reserva.corte != null ? reserva.corte.nombre : 'N/A'}"
                                                th:data-precio="${reserva.corte != null and reserva.corte.precio != null ? reserva.corte.precio : 0}"
                                                th:data-duracion="${reserva.corte != null and reserva.corte.duracion != null ? reserva.corte.duracion.toString() : 'N/A'}"
                                                th:data-fecha-hora="${reserva.fechaHoraTurno != null ? #temporals.format(reserva.fechaHoraTurno, 'dd/MM/yyyy hh:mm a') : 'N/A'}"
                                                th:data-fecha-hora-iso="${reserva.fechaHoraTurno}"
                                                th:data-estado="${reserva.estado.name()}"
                                                th:data-barbero="${nombreBarbero}"
                                                onclick="verDetalle(this)">
                                            <i class="bi bi-eye"></i> Ver
                                        </button>
                                        <button th:if="${reserva.estado.name() == 'PENDIENTE'}"
                                                class="btn btn-success btn-sm"
                                                th:data-reserva-id="${reserva.idReserva}"
                                                th:data-cliente="${reserva.cliente != null ? reserva.cliente.nombre : 'N/A'}"
                                                th:data-fecha="${reserva.fechaHoraTurno != null ? #temporals.format(reserva.fechaHoraTurno, 'dd/MM/yyyy HH:mm') : 'N/A'}"
                                                th:data-fecha-hora-iso="${reserva.fechaHoraTurno}"
                                                onclick="mostrarModalCompletar(this)">
                                            <i class="bi bi-check-circle"></i> Completar
                                        </button>
                                        <button th:if="${reserva.estado.name() == 'PENDIENTE'}"
                                                class="btn btn-warning btn-sm"
                                                th:data-reserva-id="${reserva.idReserva}"
                                                th:data-cliente="${reserva.cliente != null ? reserva.cliente.nombre : 'N/A'}"
                                                th:data-fecha="${reserva.fechaHoraTurno != null ? #temporals.format(reserva.fechaHoraTurno, 'dd/MM/yyyy HH:mm') : 'N/A'}"
                                                onclick="mostrarModalCancelar(this)">
                                            <i class="bi bi-x-circle"></i> Cancelar
                                        </button>
                                        <button type="button"
                                                class="btn btn-danger btn-sm"
                                                th:data-reserva-id="${reserva.idReserva}"
                                                th:data-cliente="${reserva.cliente != null ? reserva.cliente.nombre : 'N/A'}"
                                                th:data-fecha="${reserva.fechaHoraTurno != null ? #temporals.format(reserva.fechaHoraTurno, 'dd/MM/yyyy HH:mm') : 'N/A'}"
                                                onclick="mostrarModalEliminar(this)">
                                            <i class="bi bi-trash"></i> Eliminar
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr th:if="${reservasHoyList == null || #lists.isEmpty(reservasHoyList)}">
                                <td colspan="7" class="text-center">No hay reservas para mostrar en este período</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Completar -->
    <div class="modal fade" id="modalCompletar" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title"><i class="bi bi-check-circle"></i> Completar Reserva</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-3">
                        <i class="bi bi-check-circle text-success" style="font-size: 3rem;"></i>
                    </div>
                    <p class="text-center"><strong>¿Confirmas que has completado esta reserva?</strong></p>
                    <div class="card bg-light">
                        <div class="card-body">
                            <p class="mb-1"><strong>Cliente:</strong> <span id="completarCliente">-</span></p>
                            <p class="mb-0"><strong>Fecha:</strong> <span id="completarFecha">-</span></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <a id="btnConfirmarCompletar" href="#" class="btn btn-success">
                        <i class="bi bi-check-circle"></i> Sí, Completar
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Advertencia - Reserva Futura -->
    <div class="modal fade" id="modalAdvertenciaFutura" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-warning">
                    <h5 class="modal-title"><i class="bi bi-exclamation-triangle"></i> Reserva Futura</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-3">
                        <i class="bi bi-clock-history text-warning" style="font-size: 3rem;"></i>
                    </div>
                    <p class="text-center"><strong>No puedes completar esta reserva todavía</strong></p>
                    <div class="alert alert-warning">
                        <i class="bi bi-info-circle"></i> Solo puedes completar una reserva después de su fecha y hora programada.
                    </div>
                    <div class="card bg-light">
                        <div class="card-body">
                            <p class="mb-1"><strong>Cliente:</strong> <span id="advertenciaCliente">-</span></p>
                            <p class="mb-1"><strong>Reserva programada para:</strong> <span id="advertenciaFecha">-</span></p>
                            <p class="mb-0"><strong>Tiempo restante:</strong> <span id="advertenciaTiempo" class="text-primary fw-bold">-</span></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">
                        <i class="bi bi-check-circle"></i> Entendido
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Cancelar -->
    <div class="modal fade" id="modalCancelar" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-warning">
                    <h5 class="modal-title"><i class="bi bi-x-circle"></i> Cancelar Reserva</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-3">
                        <i class="bi bi-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
                    </div>
                    <p class="text-center"><strong>¿Estás seguro de cancelar esta reserva?</strong></p>
                    <div class="card bg-light">
                        <div class="card-body">
                            <p class="mb-1"><strong>Cliente:</strong> <span id="cancelarCliente">-</span></p>
                            <p class="mb-0"><strong>Fecha:</strong> <span id="cancelarFecha">-</span></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No, Volver</button>
                    <a id="btnConfirmarCancelar" href="#" class="btn btn-warning">
                        <i class="bi bi-x-circle"></i> Sí, Cancelar
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Eliminar -->
    <div class="modal fade" id="modalEliminar" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title"><i class="bi bi-trash"></i> Eliminar Reserva</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-3">
                        <i class="bi bi-trash text-danger" style="font-size: 3rem;"></i>
                    </div>
                    <p class="text-center"><strong>¿Estás seguro de eliminar esta reserva?</strong></p>
                    <div class="alert alert-danger">
                        <small><i class="bi bi-exclamation-triangle-fill"></i> Esta acción no se puede deshacer</small>
                    </div>
                    <div class="card bg-light">
                        <div class="card-body">
                            <p class="mb-1"><strong>Cliente:</strong> <span id="eliminarCliente">-</span></p>
                            <p class="mb-0"><strong>Fecha:</strong> <span id="eliminarFecha">-</span></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <a id="btnConfirmarEliminar" href="#" class="btn btn-danger">
                        <i class="bi bi-trash"></i> Sí, Eliminar
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Detalle MEJORADO -->
    <div class="modal fade" id="detalleModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title"><i class="bi bi-info-circle"></i> Detalle de Reserva</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <h6 class="text-muted"><i class="bi bi-person"></i> Información del Cliente</h6>
                            <hr>
                            <p><strong>Nombre:</strong> <span id="detalleClienteNombre">-</span></p>
                            <p><strong>Teléfono:</strong> <span id="detalleClienteTelefono">-</span></p>
                            <p><strong>Email:</strong> <span id="detalleClienteEmail">-</span></p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <h6 class="text-muted"><i class="bi bi-scissors"></i> Información del Servicio</h6>
                            <hr>
                            <p><strong>Servicio:</strong> <span id="detalleServicio">-</span></p>
                            <p><strong>Precio:</strong> $<span id="detallePrecio">-</span></p>
                            <p><strong>Duración:</strong> <span id="detalleDuracion">-</span></p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <h6 class="text-muted"><i class="bi bi-calendar-check"></i> Información de la Reserva</h6>
                            <hr>
                            <p><strong>Fecha y Hora:</strong> <span id="detalleFechaHora">-</span></p>
                            <p><strong>Estado:</strong> <span id="detalleEstado" class="badge">-</span></p>
                            <p><strong>ID Reserva:</strong> #<span id="detalleIdReserva">-</span></p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <h6 class="text-muted"><i class="bi bi-person-badge"></i> Barbero Asignado</h6>
                            <hr>
                            <p><strong>Nombre:</strong> <span id="detalleBarbero">-</span></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle"></i> Cerrar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>Barbería Estilo - Panel del Barbero</h5>
                    <p>Sistema de gestión para barberos.</p>
                </div>
            </div>
            <div class="text-center mt-4">
                <p>&copy; 2025 Barbería Estilo. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script th:inline="javascript">
        const filtroActual = /*[[${filtroActual}]]*/ 'hoy';

        function mostrarModalCompletar(button) {
            const reservaId = button.getAttribute('data-reserva-id');
            const cliente = button.getAttribute('data-cliente');
            const fecha = button.getAttribute('data-fecha');
            const fechaHoraISO = button.getAttribute('data-fecha-hora-iso');
            
            // Validar que la fecha/hora de la reserva ya haya pasado
            const fechaReserva = new Date(fechaHoraISO);
            const ahora = new Date();
            
            if (ahora < fechaReserva) {
                // La reserva es futura, mostrar modal de advertencia
                mostrarModalAdvertenciaFutura(cliente, fecha, fechaReserva, ahora);
                return;
            }
            
            // Si ya pasó la hora, mostrar modal de confirmación normal
            document.getElementById('completarCliente').textContent = cliente;
            document.getElementById('completarFecha').textContent = fecha;
            
            const url = `/barbero/reservas/completar/${reservaId}?filtro=${filtroActual}`;
            document.getElementById('btnConfirmarCompletar').setAttribute('href', url);
            
            const modal = new bootstrap.Modal(document.getElementById('modalCompletar'));
            modal.show();
        }

        function mostrarModalAdvertenciaFutura(cliente, fecha, fechaReserva, ahora) {
            document.getElementById('advertenciaCliente').textContent = cliente;
            document.getElementById('advertenciaFecha').textContent = fecha;
            
            // Calcular tiempo restante
            const diferenciaMilisegundos = fechaReserva - ahora;
            const tiempoRestante = calcularTiempoRestante(diferenciaMilisegundos);
            document.getElementById('advertenciaTiempo').textContent = tiempoRestante;
            
            const modal = new bootstrap.Modal(document.getElementById('modalAdvertenciaFutura'));
            modal.show();
        }

        function calcularTiempoRestante(milisegundos) {
            const segundos = Math.floor(milisegundos / 1000);
            const minutos = Math.floor(segundos / 60);
            const horas = Math.floor(minutos / 60);
            const dias = Math.floor(horas / 24);
            
            if (dias > 0) {
                const horasRestantes = horas % 24;
                return `${dias} día${dias > 1 ? 's' : ''} y ${horasRestantes} hora${horasRestantes !== 1 ? 's' : ''}`;
            } else if (horas > 0) {
                const minutosRestantes = minutos % 60;
                return `${horas} hora${horas > 1 ? 's' : ''} y ${minutosRestantes} minuto${minutosRestantes !== 1 ? 's' : ''}`;
            } else if (minutos > 0) {
                return `${minutos} minuto${minutos > 1 ? 's' : ''}`;
            } else {
                return `${segundos} segundo${segundos !== 1 ? 's' : ''}`;
            }
        }

        function mostrarModalCancelar(button) {
            const reservaId = button.getAttribute('data-reserva-id');
            const cliente = button.getAttribute('data-cliente');
            const fecha = button.getAttribute('data-fecha');
            
            document.getElementById('cancelarCliente').textContent = cliente;
            document.getElementById('cancelarFecha').textContent = fecha;
            
            const url = `/barbero/reservas/cancelar/${reservaId}?filtro=${filtroActual}`;
            document.getElementById('btnConfirmarCancelar').setAttribute('href', url);
            
            const modal = new bootstrap.Modal(document.getElementById('modalCancelar'));
            modal.show();
        }

        function mostrarModalEliminar(button) {
            const reservaId = button.getAttribute('data-reserva-id');
            const cliente = button.getAttribute('data-cliente');
            const fecha = button.getAttribute('data-fecha');
            
            document.getElementById('eliminarCliente').textContent = cliente;
            document.getElementById('eliminarFecha').textContent = fecha;
            
            const url = `/barbero/reservas/eliminar/${reservaId}?filtro=${filtroActual}`;
            document.getElementById('btnConfirmarEliminar').setAttribute('href', url);
            
            const modal = new bootstrap.Modal(document.getElementById('modalEliminar'));
            modal.show();
        }

        function verDetalle(button) {
            const id = button.getAttribute('data-id');
            const clienteNombre = button.getAttribute('data-cliente-nombre');
            const clienteTelefono = button.getAttribute('data-cliente-telefono');
            const clienteCorreo = button.getAttribute('data-cliente-correo');
            const servicio = button.getAttribute('data-servicio');
            const precio = button.getAttribute('data-precio');
            const duracion = button.getAttribute('data-duracion');
            const fechaHora = button.getAttribute('data-fecha-hora');
            const estado = button.getAttribute('data-estado');
            const barbero = button.getAttribute('data-barbero');

            console.log('=== DEBUG DURACIÓN ===');
            console.log('Duración recibida:', duracion);
            console.log('Tipo de dato:', typeof duracion);
            console.log('Duración como string:', String(duracion));

            document.getElementById('detalleIdReserva').textContent = id;
            document.getElementById('detalleClienteNombre').textContent = clienteNombre;
            document.getElementById('detalleClienteTelefono').textContent = clienteTelefono;
            document.getElementById('detalleClienteEmail').textContent = clienteCorreo;
            document.getElementById('detalleServicio').textContent = servicio;
            document.getElementById('detallePrecio').textContent = new Intl.NumberFormat('es-CO').format(precio);
            
            // MEJORA: Mostrar la duración correctamente
            let duracionTexto = 'No especificada';
            
            if (duracion && duracion !== 'N/A' && duracion !== 'null' && duracion !== '') {
                const duracionStr = String(duracion).trim();
                console.log('Duración procesando:', duracionStr);
                
                // Si es exactamente "0", mostrar mensaje especial
                if (duracionStr === '0' || duracionStr === '0.0') {
                    duracionTexto = 'No configurada';
                    console.log('⚠️ ADVERTENCIA: La duración es 0. Verifica la base de datos.');
                }
                // Si contiene ":" es formato de tiempo (HH:mm:ss o mm:ss)
                else if (duracionStr.includes(':')) {
                    const partes = duracionStr.split(':');
                    console.log('Partes separadas por ":"', partes);
                    
                    if (partes.length === 3) {
                        // Formato HH:mm:ss
                        const horas = parseInt(partes[0]);
                        const minutos = parseInt(partes[1]);
                        
                        console.log('Horas:', horas, 'Minutos:', minutos);
                        
                        if (horas > 0) {
                            duracionTexto = `${horas}h ${minutos}min`;
                        } else if (minutos > 0) {
                            duracionTexto = `${minutos} minutos`;
                        } else {
                            duracionTexto = 'No configurada';
                        }
                    } else if (partes.length === 2) {
                        // Formato mm:ss
                        const minutos = parseInt(partes[0]);
                        if (minutos > 0) {
                            duracionTexto = `${minutos} minutos`;
                        } else {
                            duracionTexto = 'No configurada';
                        }
                    }
                } else {
                    // Si es un número, asumimos que son minutos
                    const mins = parseInt(duracionStr);
                    console.log('Duración como número:', mins);
                    
                    if (!isNaN(mins) && mins > 0) {
                        if (mins >= 60) {
                            const horas = Math.floor(mins / 60);
                            const minutosRestantes = mins % 60;
                            if (minutosRestantes > 0) {
                                duracionTexto = `${horas}h ${minutosRestantes}min`;
                            } else {
                                duracionTexto = `${horas}h`;
                            }
                        } else {
                            duracionTexto = `${mins} minutos`;
                        }
                    } else if (mins === 0) {
                        duracionTexto = 'No configurada';
                        console.log('⚠️ ADVERTENCIA: La duración es 0. Verifica la base de datos.');
                    }
                }
            }
            
            console.log('Duración procesada FINAL:', duracionTexto);
            console.log('=====================');
            
            document.getElementById('detalleDuracion').textContent = duracionTexto;
            document.getElementById('detalleFechaHora').textContent = fechaHora;
            document.getElementById('detalleBarbero').textContent = barbero;
            
            const estadoBadge = document.getElementById('detalleEstado');
            estadoBadge.textContent = estado;
            estadoBadge.className = 'badge ';
            
            if (estado === 'COMPLETADA') {
                estadoBadge.classList.add('bg-success');
            } else if (estado === 'CANCELADA') {
                estadoBadge.classList.add('bg-danger');
            } else {
                estadoBadge.classList.add('bg-warning');
            }

            const modal = new bootstrap.Modal(document.getElementById('detalleModal'));
            modal.show();
        }
    </script>
</body>
</html>