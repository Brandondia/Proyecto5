<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Estad√≠sticas - Panel del Barbero</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #0d6efd;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --danger-color: #dc3545;
        }
        
        .stats-card {
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: none;
            transition: all 0.3s;
            height: 100%;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        
        .metric-box {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            height: 100%;
            transition: all 0.3s;
        }
        
        .metric-box:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .metric-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .metric-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
        }
        
        .period-selector {
            margin-bottom: 20px;
        }
        
        .period-selector .btn {
            font-size: 0.9rem;
            padding: 10px 15px;
        }
        
        @media (max-width: 768px) {
            .period-selector .btn {
                font-size: 0.8rem;
                padding: 8px 10px;
            }
            .period-selector .btn i {
                display: none;
            }
        }
        
        .ranking-item {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #e0e0e0;
            transition: all 0.3s;
        }
        
        .ranking-item:hover {
            background: #f8f9fa;
            border-color: var(--primary-color);
            transform: translateX(5px);
        }
        
        .ranking-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .progress-custom {
            height: 25px;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-custom .progress-bar {
            transition: width 1s ease-in-out;
        }
        
        .no-data-message {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 250px;
            color: #6c757d;
            text-align: center;
            flex-direction: column;
        }
        
        .badge-change {
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.85rem;
        }
        
        .loading-skeleton {
            animation: pulse 1.5s ease-in-out infinite;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
        }
        
        @keyframes pulse {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .objetivo-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        
        /* Mejora de accesibilidad */
        .btn:focus, .btn-check:focus + .btn {
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
        }
        
        /* Mejora en gr√°ficos responsivos */
        @media (max-width: 992px) {
            .chart-container {
                height: 250px;
            }
        }
        
        /* Estilos para impresi√≥n */
        @media print {
            .navbar, footer, .btn { display: none !important; }
            .stats-card { box-shadow: none; border: 1px solid #ddd; }
            .chart-container { height: 400px !important; }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
        <div class="container">
            <a class="navbar-brand" href="/barbero/panel">
                <i class="bi bi-scissors"></i> Panel del Barbero
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/barbero/panel">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/barbero/reservas">
                            <i class="bi bi-calendar-check"></i> Mis Reservas
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/barbero/horario">
                            <i class="bi bi-clock"></i> Mi Horario
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/barbero/ausencias">
                            <i class="bi bi-calendar-x"></i> Ausencias
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/barbero/estadisticas">
                            <i class="bi bi-graph-up"></i> Estad√≠sticas
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" 
                           data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-person-circle"></i> 
                            <span th:text="${nombreBarbero}">Barbero</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                            <li>
                                <a class="dropdown-item" href="/barbero/perfil">
                                    <i class="bi bi-person"></i> Mi Perfil
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item" href="/logout">
                                    <i class="bi bi-box-arrow-right"></i> Cerrar Sesi√≥n
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container py-5">
        <!-- Header con bot√≥n de volver -->
        <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
            <div>
                <h1 class="mb-1">
                    <i class="bi bi-graph-up text-primary"></i> Mis Estad√≠sticas
                </h1>
                <p class="text-muted mb-0">An√°lisis de tu desempe√±o y rendimiento</p>
            </div>
            <div class="d-flex gap-2">
                <button onclick="window.print()" class="btn btn-outline-secondary" title="Imprimir estad√≠sticas">
                    <i class="bi bi-printer"></i> Imprimir
                </button>
                <a href="/barbero/panel" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Volver
                </a>
            </div>
        </div>

        <!-- Alerta de error (si existe) -->
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="bi bi-exclamation-triangle-fill"></i>
            <strong>Error:</strong> <span th:text="${error}">Error message</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>

        <!-- Selector de Per√≠odo -->
        <div class="period-selector">
            <div class="btn-group w-100" role="group" aria-label="Selector de per√≠odo">
                <a th:href="@{/barbero/estadisticas(periodo='semana')}" 
                   th:classappend="${periodo == 'semana' ? 'active' : ''}"
                   class="btn btn-outline-primary"
                   th:attr="aria-current=${periodo == 'semana' ? 'page' : null}">
                    <i class="bi bi-calendar-week"></i> Esta Semana
                </a>
                
                <a th:href="@{/barbero/estadisticas(periodo='mes')}" 
                   th:classappend="${periodo == 'mes' ? 'active' : ''}"
                   class="btn btn-outline-primary"
                   th:attr="aria-current=${periodo == 'mes' ? 'page' : null}">
                    <i class="bi bi-calendar-month"></i> Este Mes
                </a>
                
                <a th:href="@{/barbero/estadisticas(periodo='trimestre')}" 
                   th:classappend="${periodo == 'trimestre' ? 'active' : ''}"
                   class="btn btn-outline-primary"
                   th:attr="aria-current=${periodo == 'trimestre' ? 'page' : null}">
                    <i class="bi bi-calendar3"></i> Trimestre
                </a>
                
                <a th:href="@{/barbero/estadisticas(periodo='anio')}" 
                   th:classappend="${periodo == 'anio' ? 'active' : ''}"
                   class="btn btn-outline-primary"
                   th:attr="aria-current=${periodo == 'anio' ? 'page' : null}">
                    <i class="bi bi-calendar-event"></i> Este A√±o
                </a>
            </div>
        </div>

        <!-- M√©tricas Principales -->
        <div class="row mb-4">
            <div class="col-md-6 col-lg-3 mb-3">
                <div class="metric-box">
                    <div class="metric-icon text-primary">
                        <i class="bi bi-scissors"></i>
                    </div>
                    <div class="metric-value text-primary" th:text="${totalCortes}">0</div>
                    <div class="metric-label">Total Cortes</div>
                    <small th:class="${cambioCortes >= 0 ? 'badge-change bg-success-subtle text-success' : 'badge-change bg-danger-subtle text-danger'}">
                        <i th:class="${cambioCortes >= 0 ? 'bi bi-arrow-up' : 'bi bi-arrow-down'}"></i>
                        <span th:text="${cambioCortesPorcentaje}">0%</span>
                    </small>
                </div>
            </div>
            
            <div class="col-md-6 col-lg-3 mb-3">
                <div class="metric-box">
                    <div class="metric-icon text-success">
                        <i class="bi bi-cash-stack"></i>
                    </div>
                    <div class="metric-value text-success">
                        $<span th:text="${#numbers.formatInteger(ingresosGenerados, 0, 'COMMA')}">0</span>
                    </div>
                    <div class="metric-label">Ingresos Generados</div>
                    <small th:class="${cambioIngresos >= 0 ? 'badge-change bg-success-subtle text-success' : 'badge-change bg-danger-subtle text-danger'}">
                        <i th:class="${cambioIngresos >= 0 ? 'bi bi-arrow-up' : 'bi bi-arrow-down'}"></i>
                        <span th:text="${cambioIngresosPorcentaje}">0%</span>
                    </small>
                </div>
            </div>
            
            <div class="col-md-6 col-lg-3 mb-3">
                <div class="metric-box">
                    <div class="metric-icon text-warning">
                        <i class="bi bi-star-fill"></i>
                    </div>
                    <div class="metric-value text-warning" th:text="${#numbers.formatDecimal(valoracionPromedio, 1, 1)}">4.8</div>
                    <div class="metric-label">Valoraci√≥n Promedio</div>
                    <small class="text-muted">
                        <i class="bi bi-star-fill" style="font-size: 0.7rem;"></i> Sistema de valoraciones
                    </small>
                </div>
            </div>
            
            <div class="col-md-6 col-lg-3 mb-3">
                <div class="metric-box">
                    <div class="metric-icon text-info">
                        <i class="bi bi-people"></i>
                    </div>
                    <div class="metric-value text-info" th:text="${clientesAtendidos}">0</div>
                    <div class="metric-label">Clientes Atendidos</div>
                    <small class="text-info">
                        <i class="bi bi-person-check"></i> Clientes √∫nicos
                    </small>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Gr√°fico de Cortes por D√≠a -->
            <div class="col-lg-8 mb-4">
                <div class="card stats-card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-bar-chart"></i> Cortes por D√≠a
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="cortesChart" role="img" aria-label="Gr√°fico de cortes por d√≠a"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Distribuci√≥n de Servicios -->
            <div class="col-lg-4 mb-4">
                <div class="card stats-card">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-pie-chart"></i> Servicios M√°s Solicitados
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container" style="height: 250px;" id="serviciosChartContainer">
                            <canvas id="serviciosChart" role="img" aria-label="Gr√°fico de servicios m√°s solicitados"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Ingresos Mensuales -->
            <div class="col-lg-8 mb-4">
                <div class="card stats-card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-cash-coin"></i> Ingresos Mensuales (√öltimos 6 Meses)
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="ingresosChart" role="img" aria-label="Gr√°fico de ingresos mensuales"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Horarios M√°s Ocupados -->
            <div class="col-lg-4 mb-4">
                <div class="card stats-card">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-clock-history"></i> Horarios M√°s Ocupados
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container" style="height: 350px;" id="horariosChartContainer">
                            <canvas id="horariosChart" role="img" aria-label="Gr√°fico de horarios m√°s ocupados"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Top Servicios y Objetivos -->
        <div class="row">
            <!-- Top Servicios -->
            <div class="col-lg-6 mb-4">
                <div class="card stats-card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-trophy"></i> Top Servicios del Per√≠odo
                        </h5>
                    </div>
                    <div class="card-body">
                        <div th:if="${topServicios == null || topServicios.isEmpty()}" class="no-data-message">
                            <i class="bi bi-inbox fs-1 mb-3 text-muted"></i>
                            <p class="mb-0">No hay datos para mostrar en este per√≠odo</p>
                        </div>
                        
                        <div th:each="entry, iterStat : ${topServicios}" class="ranking-item">
                            <div class="d-flex align-items-center">
                                <div class="ranking-number me-3" 
                                     th:classappend="${iterStat.index == 0 ? 'bg-warning text-white' : 
                                                      (iterStat.index == 1 ? 'bg-secondary text-white' : 
                                                      (iterStat.index == 2 ? 'bg-info text-white' : 'bg-light text-dark'))}"
                                     th:text="${iterStat.index + 1}">1</div>
                                <div class="flex-grow-1">
                                    <strong th:text="${entry.key}">Servicio</strong>
                                    <div class="progress mt-2" style="height: 8px;">
                                        <div class="progress-bar" 
                                             th:classappend="${iterStat.index == 0 ? 'bg-warning' : 
                                                             (iterStat.index == 1 ? 'bg-secondary' : 
                                                             (iterStat.index == 2 ? 'bg-info' : ''))}"
                                             th:style="'width: ' + ${totalCortes > 0 ? (entry.value.cantidad * 100 / totalCortes) : 0} + '%'"
                                             role="progressbar"
                                             th:attr="aria-valuenow=${totalCortes > 0 ? (entry.value.cantidad * 100 / totalCortes) : 0}, aria-valuemin=0, aria-valuemax=100"></div>
                                    </div>
                                </div>
                                <div class="ms-3 text-end">
                                    <strong><span th:text="${entry.value.cantidad}">0</span> cortes</strong>
                                    <div>
                                        <small class="text-muted">
                                            $<span th:text="${#numbers.formatInteger(entry.value.ingresos, 0, 'COMMA')}">0</span>
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Objetivos del Mes -->
            <div class="col-lg-6 mb-4">
                <div class="card stats-card">
                    <div class="card-header bg-dark text-white position-relative">
                        <h5 class="mb-0">
                            <i class="bi bi-bullseye"></i> Objetivos del Mes
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- Cortes -->
                        <div class="mb-4 position-relative">
                            <h6 class="d-flex align-items-center justify-content-between">
                                <span><i class="bi bi-scissors text-primary"></i> Cortes Realizados</span>
                                <span th:if="${progresoCortes >= 100}" class="badge bg-success">
                                    <i class="bi bi-check-circle"></i> Completado
                                </span>
                            </h6>
                            <div class="d-flex justify-content-between mb-2">
                                <span><strong th:text="${totalCortes}">0</strong> / <span th:text="${objetivoCortes}">60</span></span>
                                <span class="text-primary fw-bold" th:text="${#numbers.formatDecimal(progresoCortes, 0, 0) + '%'}">0%</span>
                            </div>
                            <div class="progress progress-custom">
                                <div class="progress-bar bg-primary" 
                                     th:style="'width: ' + ${progresoCortes} + '%'"
                                     role="progressbar"
                                     th:attr="aria-valuenow=${progresoCortes}, aria-valuemin=0, aria-valuemax=100"></div>
                            </div>
                        </div>
                        
                        <!-- Ingresos -->
                        <div class="mb-4 position-relative">
                            <h6 class="d-flex align-items-center justify-content-between">
                                <span><i class="bi bi-cash-stack text-success"></i> Ingresos Objetivo</span>
                                <span th:if="${progresoIngresos >= 100}" class="badge bg-success">
                                    <i class="bi bi-check-circle"></i> Completado
                                </span>
                            </h6>
                            <div class="d-flex justify-content-between mb-2">
                                <span>
                                    <strong>$<span th:text="${#numbers.formatInteger(ingresosGenerados, 0, 'COMMA')}">0</span></strong> / 
                                    $<span th:text="${#numbers.formatInteger(objetivoIngresos, 0, 'COMMA')}">1,500,000</span>
                                </span>
                                <span class="text-success fw-bold" th:text="${#numbers.formatDecimal(progresoIngresos, 0, 0) + '%'}">0%</span>
                            </div>
                            <div class="progress progress-custom">
                                <div class="progress-bar bg-success" 
                                     th:style="'width: ' + ${progresoIngresos} + '%'"
                                     role="progressbar"
                                     th:attr="aria-valuenow=${progresoIngresos}, aria-valuemin=0, aria-valuemax=100"></div>
                            </div>
                        </div>
                        
                        <!-- Valoraci√≥n -->
                        <div class="mb-3 position-relative">
                            <h6 class="d-flex align-items-center justify-content-between">
                                <span><i class="bi bi-star-fill text-warning"></i> Valoraci√≥n Objetivo</span>
                                <span th:if="${progresoValoracion >= 100}" class="badge bg-success">
                                    <i class="bi bi-check-circle"></i> Superado
                                </span>
                            </h6>
                            <div class="d-flex justify-content-between mb-2">
                                <span>
                                    <strong th:text="${#numbers.formatDecimal(valoracionActual, 1, 1)}">0.0</strong> / 
                                    <span th:text="${#numbers.formatDecimal(objetivoValoracion, 1, 1)}">4.5</span>
                                </span>
                                <span class="text-warning fw-bold" th:text="${#numbers.formatDecimal(progresoValoracion, 0, 0) + '%'}">0%</span>
                            </div>
                            <div class="progress progress-custom">
                                <div class="progress-bar bg-warning" 
                                     th:style="'width: ' + ${progresoValoracion} + '%'"
                                     role="progressbar"
                                     th:attr="aria-valuenow=${progresoValoracion}, aria-valuemin=0, aria-valuemax=100"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container text-center">
            <p class="mb-0">&copy; 2025 Barber√≠a Estilo. Panel del Barbero - Todos los derechos reservados.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script th:inline="javascript">
        /*<![CDATA[*/
        
        // Configuraci√≥n global de Chart.js
        Chart.defaults.font.family = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial';
        Chart.defaults.plugins.legend.labels.usePointStyle = true;
        Chart.defaults.plugins.tooltip.backgroundColor = 'rgba(0, 0, 0, 0.8)';
        Chart.defaults.plugins.tooltip.padding = 12;
        Chart.defaults.plugins.tooltip.cornerRadius = 8;
        
        window.addEventListener('load', function() {
            console.log('üîÑ Iniciando carga de gr√°ficos...');
            
            if (typeof Chart === 'undefined') {
                console.error('‚ùå Chart.js NO est√° cargado');
                showError('Error al cargar las gr√°ficas. Por favor, recargue la p√°gina.');
                return;
            }
            console.log('‚úÖ Chart.js detectado correctamente');
            
            // Datos desde el servidor
            const cortesPorDiaLabels = /*[[${cortesPorDiaLabels}]]*/ [];
            const cortesPorDiaData = /*[[${cortesPorDiaData}]]*/ [];
            
            const serviciosLabels = /*[[${serviciosLabels}]]*/ [];
            const serviciosData = /*[[${serviciosData}]]*/ [];
            
            const horariosLabels = /*[[${horariosLabels}]]*/ [];
            const horariosData = /*[[${horariosData}]]*/ [];
            
            const ingresosMensualesLabels = /*[[${ingresosMensualesLabels}]]*/ [];
            const ingresosMensualesData = /*[[${ingresosMensualesData}]]*/ [];

            console.log('üìä Datos recibidos:', {
                cortes: cortesPorDiaData.length,
                servicios: serviciosData.length,
                horarios: horariosData.length,
                ingresos: ingresosMensualesData.length
            });

            // ========== GR√ÅFICO 1: CORTES POR D√çA ==========
            try {
                const ctx1 = document.getElementById('cortesChart');
                if (ctx1) {
                    new Chart(ctx1.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: cortesPorDiaLabels,
                            datasets: [{
                                label: 'Cortes realizados',
                                data: cortesPorDiaData,
                                borderColor: '#0d6efd',
                                backgroundColor: 'rgba(13, 110, 253, 0.1)',
                                tension: 0.4,
                                fill: true,
                                pointRadius: 5,
                                pointHoverRadius: 7,
                                pointBackgroundColor: '#0d6efd',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false },
                                tooltip: {
                                    callbacks: {
                                        label: (context) => `Cortes: ${context.parsed.y}`
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: { 
                                        stepSize: 1,
                                        precision: 0
                                    }
                                }
                            }
                        }
                    });
                    console.log('‚úÖ Gr√°fico cortes creado');
                }
            } catch (e) {
                console.error('‚ùå Error gr√°fico cortes:', e);
            }

            // ========== GR√ÅFICO 2: SERVICIOS ==========
            try {
                if (serviciosData.length > 0) {
                    const ctx2 = document.getElementById('serviciosChart');
                    if (ctx2) {
                        new Chart(ctx2.getContext('2d'), {
                            type: 'doughnut',
                            data: {
                                labels: serviciosLabels,
                                datasets: [{
                                    data: serviciosData,
                                    backgroundColor: [
                                        '#0d6efd',
                                        '#28a745',
                                        '#ffc107',
                                        '#dc3545',
                                        '#6c757d',
                                        '#17a2b8',
                                        '#fd7e14'
                                    ],
                                    borderWidth: 2,
                                    borderColor: '#fff'
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: { 
                                        position: 'bottom',
                                        labels: {
                                            padding: 15,
                                            font: { size: 11 }
                                        }
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: (context) => {
                                                const label = context.label || '';
                                                const value = context.parsed || 0;
                                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                                const percentage = ((value / total) * 100).toFixed(1);
                                                return `${label}: ${value} (${percentage}%)`;
                                            }
                                        }
                                    }
                                }
                            }
                        });
                        console.log('‚úÖ Gr√°fico servicios creado');
                    }
                } else {
                    document.getElementById('serviciosChartContainer').innerHTML = 
                        '<div class="no-data-message"><i class="bi bi-inbox fs-1 mb-2"></i><p class="mb-0">No hay datos</p></div>';
                    console.log('‚ö†Ô∏è Sin datos de servicios');
                }
            } catch (e) {
                console.error('‚ùå Error gr√°fico servicios:', e);
            }

            // ========== GR√ÅFICO 3: INGRESOS ==========
            try {
                const ctx3 = document.getElementById('ingresosChart');
                if (ctx3) {
                    new Chart(ctx3.getContext('2d'), {
                        type: 'bar',
                        data: {
                            labels: ingresosMensualesLabels,
                            datasets: [{
                                label: 'Ingresos',
                                data: ingresosMensualesData,
                                backgroundColor: '#17a2b8',
                                borderRadius: 8,
                                borderSkipped: false
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false },
                                tooltip: {
                                    callbacks: {
                                        label: (context) => {
                                            const value = context.parsed.y || 0;
                                            return `Ingresos: ${value.toLocaleString('es-CO')}`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: (value) => '$' + value.toLocaleString('es-CO')
                                    }
                                }
                            }
                        }
                    });
                    console.log('‚úÖ Gr√°fico ingresos creado');
                }
            } catch (e) {
                console.error('‚ùå Error gr√°fico ingresos:', e);
            }

            // ========== GR√ÅFICO 4: HORARIOS ==========
            try {
                if (horariosData.length > 0) {
                    const ctx4 = document.getElementById('horariosChart');
                    if (ctx4) {
                        new Chart(ctx4.getContext('2d'), {
                            type: 'bar',
                            data: {
                                labels: horariosLabels,
                                datasets: [{
                                    label: 'Reservas',
                                    data: horariosData,
                                    backgroundColor: '#28a745',
                                    borderRadius: 6,
                                    borderSkipped: false
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                indexAxis: 'y',
                                plugins: {
                                    legend: { display: false },
                                    tooltip: {
                                        callbacks: {
                                            label: (context) => `Reservas: ${context.parsed.x}`
                                        }
                                    }
                                },
                                scales: {
                                    x: {
                                        beginAtZero: true,
                                        ticks: { 
                                            stepSize: 1,
                                            precision: 0
                                        }
                                    }
                                }
                            }
                        });
                        console.log('‚úÖ Gr√°fico horarios creado');
                    }
                } else {
                    document.getElementById('horariosChartContainer').innerHTML = 
                        '<div class="no-data-message"><i class="bi bi-inbox fs-1 mb-2"></i><p class="mb-0">No hay datos</p></div>';
                    console.log('‚ö†Ô∏è Sin datos de horarios');
                }
            } catch (e) {
                console.error('‚ùå Error gr√°fico horarios:', e);
            }

            console.log('‚úÖ Proceso de carga completado');
        });
        
        // Funci√≥n auxiliar para mostrar errores
        function showError(message) {
            const container = document.querySelector('.container');
            if (container) {
                const alert = document.createElement('div');
                alert.className = 'alert alert-warning alert-dismissible fade show';
                alert.innerHTML = `
                    <i class="bi bi-exclamation-triangle"></i>
                    <strong>Atenci√≥n:</strong> ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                container.insertBefore(alert, container.firstChild);
            }
        }
        
        /*]]>*/
    </script>
</body>
</html>